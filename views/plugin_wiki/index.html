{{extend 'plugin_wiki/layout.html'}}

<div id="plugin_wiki">
<!--<h1>System Pages</h1>

<h2>Create New page</h2>

<h2>Current Pages</h2>

<table>
  {{for page in pages:}}
  <tr>
    <td>{{=A(page.slug,_href=URL(r=request,f='page',args=page.slug))}}</td>
    <td><i>{{=page.title}}</i></td>
    <td>{{=page.created_on}}</td>
    <td>{{=page.is_public and 'public' or 'private'}} {{=page.role}}</td>
    <td>{{=page.is_active and 'active' or 'inactive'}}</td>
    <td>[{{=A('edit',_href=URL(r=request,f='page_edit',args=page.slug))}}]</td>
  </tr>
  {{pass}}
</table>

<h3>Info</h3>

Pages started with undescore are considered system pages. In particular:
<ul>
  <li><a href="{{=URL(r=request,f='page',args='meta-code')}}">meta-code</a> must contain code and it will be executed for every page.</li>
  <li><a href="{{=URL(r=request,f='page',args='meta-menu')}}">meta-menu</a> must contain a description of the menu.</li>
  <li><a href="{{=URL(r=request,f='page',args='meta-header')}}">meta-header</a> conatins the content of the header.</li>
  <li><a href="{{=URL(r=request,f='page',args='meta-sidebar')}}">meta-sidebar</a> conatins the content of the sidebar.</li>
  <li><a href="{{=URL(r=request,f='page',args='meta-footer')}}">meta-footer</a> conatins the content of the footer.</li>
</ul> -->

  {{request.args.append (None) }}
  {{for page in pages:}}
  {{request.args[0] = page.slug }}
  <div class="page">
    <p class="title">{{= page.title }} {{if not page.is_public: }} <span style="color:red;">UNPUBLISHED</span>{{ pass }}</p>
    <p class="date">{{= page.created_on }} by {{= user_name (page.created_by) }}</p>
    <div class="page_body">
      {{= plugin_wiki.render(page.body) }}
      <div class="page_foot">
	{{ if (check_role (editor_role) or check_user (page.created_by)): }}<a href="{{= URL(r=request,f='page_delete',args=page.slug) }}">DELETE</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="{{= URL(r=request,f='page_publish_toggle',args=page.slug) }}">{{if page.is_public: }}UN{{ pass }}PUBLISH</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="{{= URL(r=request,f='page_edit',args=page.slug) }}">EDIT</a>{{ pass }}
	</div>
    </div>
  </div>
  {{ pass }}
</div>
