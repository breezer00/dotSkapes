{{extend 'plugin_wiki/layout.html'}}
<div id="plugin_wiki">
  <div class="page">
    <div class="page_head">
      <p class="title">{{= page.title }} {{if not page.is_public: }} <span style="color:red;">UNPUBLISHED</span>{{ pass }}</p>
      <p class="date">{{= page.created_on }} by {{= user_name (page.created_by) }}</p>
    </div>
    <div class="page_body">
      {{= plugin_wiki.render(page.body) }}
      <div class="page_foot">
	{{ if (check_role (editor_role) or check_user (page.created_by)): }}<a href="{{= URL(r=request,f='page_delete',args=page.slug) }}">DELETE</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="{{= URL(r=request,f='page_publish_toggle',args=page.slug) }}">{{if page.is_public: }}UN{{ pass }}PUBLISH</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="{{= URL(r=request,f='page_edit',args=page.slug) }}">EDIT</a>{{ pass }}
	</div>
    </div>
    <div id="comments" class="page_comments">
      <p class="comments_title">Comments:</p>
      {{ if len (comments) == 0: }}
      <div class="comment_body">
	No one has posted any comments yet.
      </div>
      {{ pass }}
      {{ for comment in comments: }}
      <div class="comment_body">
	{{= comment.body }}
	<p class="date">{{= comment.created_on }} by {{= user_name (comment.created_by) }}{{if check_page_authorized (comment): }}&nbsp;&nbsp;&nbsp;&nbsp;<a href="{{= URL (r = request, f = 'delete_comment', args = [page.slug], vars = {'id': comment.id})}}">DELETE</a>{{ pass }}</p>
      </div>
      
      {{ pass }}
      <div class="comments_foot">
	{{ if check_logged_in (): }}
	<p class="comments_title">Post Comment:</p>
	<form method="POST", action="{{= URL (r = request, f = 'post_comment', args = [page.slug]) }}">
	  <textarea style="width: 100%; height: 200px;" name="body"></textarea><br />
	  <input name="submit" type="submit" value="Submit" />
	</form>
	{{ else: }}
	<p class="comments_title">Login to post a comment</p>
	{{ pass }}
      </div>
    </div>
  </div>
</div>
